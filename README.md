# 计算流体动力学(CFD)项目

## 项目简介

这是一个计算流体动力学(CFD)项目，主要用于处理三维网格模型的自相交检测和网格质量分析。项目最初包含Python和C++混合实现，
**目前正在进行架构重构，目标是将核心分析逻辑和状态管理完全迁移到 C++ 中**，以实现更高的性能和更清晰的结构。C++实现通过Python绑定调用。

## 最新版本 (V0.1.3)

V0.1.3 版本主要进行架构重构和文档更新，详见 [docs/release_notes_V0.1.3.md](docs/release_notes_V0.1.3.md)。
(V0.1.2 更新内容见 [docs/release_notes_V0.1.2.md](docs/release_notes_V0.1.2.md))

## 主要功能

**核心功能正在向 C++ 迁移，由 C++ 管理分析状态并执行增量更新。**
- 三维模型自相交检测
- 相邻面检测 (基于 Proximity 公式 `P = d / min(L_A, L_B)`)
- 穿刺面检测
- 重叠点检测
- 自由边检测
- 面片质量分析
- **网格编辑与修复工具 (UI)**:
  * 创建点 (支持坐标输入和层级选项)
  * 从选中点创建面
  * 合并选中顶点 (支持选中边)
  * 删除选定面
  * 交互式面片创建
  * (待实现功能按钮: 分割边/面, 交换边, AI修复)
- 几何计算（点到三角形距离、点到线段距离等）
- 大型网格并行处理 (依赖 C++ 核心实现)

## 目录结构

```
CFD_PROJECT/
├── src/                 # 源代码
│   ├── algorithms/      # 算法实现
│   │   ├── adjacent_faces_detector.cpp     # C++ 相邻面检测实现
│   │   └── combined_intersection_algorithm.py # Python 组合算法
│   ├── utils/           # 工具类
│   ├── mesh/            # 网格处理
│   └── ...              # 其他 C++ 扩展源文件
├── models/              # 测试用的3D模型
├── docs/                # 文档
├── tests/               # 单元测试
├── benchmark/           # 性能基准测试
├── test_performance.py  # 性能测试脚本
├── setup.py             # C++ 模块编译脚本 (推荐)
└── README.md            # 本文件
```

## 安装与使用

### 基本安装

```bash
# 克隆仓库
git clone https://github.com/fengniudashen/CFD_PROJECT.git
cd CFD_PROJECT

# 安装依赖
pip install -r requirements.txt
```

### 编译C++扩展（可选但推荐）

**注意：随着架构向完全 C++ 核心迁移，编译 C++ 模块将成为必需步骤。编译说明可能会随 V0.1.3 及后续版本更新。**

为获得最佳性能，建议编译C++扩展模块：

```bash
# 安装编译依赖 (如果尚未安装)
pip install setuptools pybind11

# 确保已安装 C++ 编译器 (如 MSVC Build Tools)
# 执行编译
python setup.py build_ext --inplace
```
详细说明请参考 `C++加速使用说明.md`。

## 性能测试

**注意：以下性能数据基于 V0.1.0 版本的旧混合架构，在 V0.1.3 及后续版本的 C++ 核心架构下，性能表现会有显著变化。新架构的基准测试将在稳定后进行更新。**

项目提供了性能测试脚本，用于比较Python和C++实现的执行效率。

### 使用方法

```bash
python test_performance.py <model_file1> [model_file2 ...]
```

### 测试结果 (基于V0.1.0, V0.1.1 相邻面逻辑已变)

*注意: V0.1.1 修改了相邻面检测逻辑，且以下数据基于旧架构，仅供参考。*

| 功能     | Python实现 | C++实现 (V0.1.0) | 加速比 (V0.1.0) |
| ------ | -------- | -------------- | --------------- |
| 相邻面检测  | 120秒     | 2.5秒          | 48倍            |
| 重叠点检测  | 35秒      | 0.3秒          | 117倍           |
| 面片质量分析 | 25秒      | 0.6秒          | 42倍            |
| 穿刺面检测  | 250秒     | 0.4秒          | 625倍           |
| 网格修复   | 180秒     | 3秒            | 60倍            |

## 多线程性能 (基于V0.1.0)

**注意：以下性能数据基于 V0.1.0 版本的旧混合架构，仅供参考。**

V0.1.0版本引入了多线程支持，以下是多线程模式下的性能对比（8核处理器测试）：

| 线程数 | 相邻面检测 (V0.1.0) | 重叠点检测 | 面片质量分析 |
| --- | --------------- | ----- | ------ |
| 1线程 | 2.5秒           | 0.3秒  | 0.6秒   |
| 4线程 | 0.8秒           | 0.1秒  | 0.2秒   |
| 8线程 | 0.5秒           | 0.06秒 | 0.12秒  |

## 算法说明

该项目旨在实现高效的网格分析和修复，核心技术包括：

1.  **C++ 状态管理器 (`CppAnalysisManager`, 开发中)**: 目标是统一管理网格数据、拓扑信息和所有分析结果，并支持高效的增量更新。
2.  **空间分割与优化**: 使用AABB包围盒和八叉树等技术快速排除不相关的计算。
3.  **精确几何计算**: 包括三角形相交测试（Möller-Trumbore算法）、点到三角形/线段的最小距离计算。
4.  **相邻面检测**: 基于 Proximity 公式 `P = d / min(L_A, L_B)` 判断面片邻近性。
5.  多线程计算框架 (将集成到 C++ 核心)。
6.  网格修复算法 (将集成到 C++ 核心)。

正在进行的 C++ 架构重构旨在通过优化数据结构、算法和状态管理，进一步大幅提高计算效率和可维护性，尤其适用于大型网格和交互式编辑场景。

## 依赖项

- Python 3.6+
- NumPy
- PyQt5（用户界面）
- VTK（3D可视化）
- pybind11（C++绑定，编译C++扩展时需要）
- C++编译器（编译C++扩展时需要）
- setuptools (编译C++扩展时需要)
- OpenMP（可选，用于多线程支持）

## 文档

详细文档请参阅`docs/`目录。关键文档包括：

- API参考：`docs/api_reference.md` (将根据 C++ 核心接口更新)
- 安装指南：`docs/installation_guide.md`
- 算法说明：`docs/self_intersection_algorithm.md` (将更新以反映 C++ 核心架构)
- 最新发布说明：`docs/release_notes_V0.1.3.md`
- 历史发布说明：`docs/release_notes_V0.1.2.md`
- C++加速/编译说明: `C++加速使用说明.md` (将根据 C++ 核心架构更新)

## 许可证

本项目采用MIT许可证。
